{"ast":null,"code":"import _objectSpread from\"C:/Users/jayka/web development/google-meet/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/jayka/web development/google-meet/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"C:/Users/jayka/web development/google-meet/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import React,{useEffect,useRef,useState,useReducer}from\"react\";import{useHistory}from\"react-router-dom\";import io from\"socket.io-client\";import Peer from\"simple-peer\";import MeetingHeader from\"./meetingHeader\";import MeetingFooter from\"./meetingFooter\";import MeetingInfo from\"./meetingInfo\";import Alert from\"./alert\";import Messenger from\"./messenger\";import{Player,ControlBar,PlayToggle}from\"video-react\";import moment from\"moment\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var vidStyle={height:\"264.15px\",width:\"639.9px\",padding:\"10px\",paddingBottom:\"5px\",objectFit:\"fill\"};var Video=function Video(props){var ref=useRef();// console.log(\"VIDEO CALLED\" + JSON.stringify(props.peer));\nuseEffect(function(){props.peer.on(\"stream\",function(stream){console.log(\"ENTE0RD\"+stream);ref.current.srcObject=stream;});},[]);return/*#__PURE__*/_jsx(\"video\",{style:vidStyle,muted:!props.isAudio,ref:ref,autoPlay:true,controls:true});};var MessageListReducer=function MessageListReducer(state,action){// let draftState = [...state];\nswitch(action.type){case\"addMessage\":return[].concat(_toConsumableArray(state),[action.payload]);default:return state;}};var Room=function Room(_ref){var id=_ref.id,isAdmin=_ref.isAdmin,setMeetingInfoPopUp=_ref.setMeetingInfoPopUp,url=_ref.url,meetingInfoPopUp=_ref.meetingInfoPopUp;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isMessenger=_useState2[0],setMessenger=_useState2[1];var numUsers=useRef();var history=useHistory();var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),peers=_useState4[0],setPeers=_useState4[1];var socketRef=useRef();var userVideo=useRef();var peersRef=useRef([]);var currentPeer=useRef();var adminPeer=useRef();var screenStream=useRef();var roomID=id;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAudio=_useState6[0],setIsAudio=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),streamObj=_useState8[0],setStreamObj=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),screenCastStream=_useState10[0],setScreenCastStream=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),isPresenting=_useState12[0],setIsPresenting=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),isVideo=_useState14[0],setIsVideo=_useState14[1];var initialState=[];var _useReducer=useReducer(MessageListReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),messageListState=_useReducer2[0],messgListReducer=_useReducer2[1];// const messageList=useRef()\nvar _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),messageList=_useState16[0],setMessageList=_useState16[1];var _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),messageAlert=_useState18[0],setMessageAlert=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),prevMessage=_useState20[0],setPrevMessage=_useState20[1];var alertTimeout=null;var formatDate=function formatDate(){return moment().format(\"LT\");};useEffect(function(){socketRef.current=io.connect(\"/\");navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){setStreamObj(stream);userVideo.current.srcObject=stream;console.log(userVideo.current);// LOGIC THAT USER HAS JOINED THE ROOM\n//THIS EVENT Is NOT CACHED AT BACKEND\n//.emit means sending  to backend\nsocketRef.current.emit(\"JOINED ROOM\");socketRef.current.emit(\"join room\",roomID);// Recieve users from backened\n// if (!props.isAdmin) {\nsocketRef.current.on(\"all users\",function(users){//peers is for how many videos are rendering\nconsole.log(users);var peersForVideo=[];users.forEach(function(userID){console.log(userID+\" USER ID OF USER IN THE ROOM \");console.log(socketRef.current);//socketRef.current.id is the of user currently joined\n// UserID  id's of all those inside the meeting\nvar peer=createPeer(userID,socketRef.current.id,stream);//peersRef is for which is having connection with which\npeersRef.current.push({peerID:userID,peer:peer});peersForVideo.push(peer);});if(peers.length<=4){setPeers(peersForVideo);}});//PERSON IN THE ROOM GETS NOTIFIED THAT SOMEBODY HAS JOINED\n//.on means recieving from backend\nsocketRef.current.on(\"user joined\",function(payload){var peer=addPeer(payload.signal,payload.callerID,stream);peersRef.current.push({peerID:payload.callerID,peer:peer});setPeers(function(users){return[].concat(_toConsumableArray(users),[peer]);});});socketRef.current.on(\"receiving returned signal\",function(payload){// signal has been send to multiple now multiple users are sending back the signal to caller\nvar item=peersRef.current.find(function(p){return p.peerID===payload.id;});console.log(item);item.peer.signal(payload.signal);// currentPeer.current = item.peer;\n// returningSignal()\n});// }\n});},[]);function createPeer(userToSignal,callerID,stream){console.log(\"CREATE PEER\");var peer=new Peer({initiator:true,//trickle wait for all the data to send makes it slow\ntrickle:false,stream:stream});currentPeer.current=peer;//generates signal\n//sending to backend\nconsole.log(userToSignal+\"  \"+callerID);peer.on(\"signal\",function(signal){socketRef.current.emit(\"sending signal\",{userToSignal:userToSignal,callerID:callerID,signal:signal});});// peer.on(\"data\", (data) => {\n// \tconsole.log(data + \"DATA\");\n// \tclearTimeout(alertTimeout);\n// \tmessgListReducer({\n// \t\ttype: \"addMessage\",\n// \t\tpayload: {\n// \t\t\tuser: userToSignal,\n// \t\t\tmsg: data.toString(),\n// \t\t\ttime: formatDate(),\n// \t\t},\n// \t});\n// \tsetMessageAlert({\n// \t\talert: true,\n// \t\tisPopup: true,\n// \t\tpayload: {\n// \t\t\tuser: userToSignal,\n// \t\t\tmsg: data.toString(),\n// \t\t},\n// \t});\n// \talertTimeout = setTimeout(() => {\n// \t\tsetMessageAlert({\n// \t\t\t...messageAlert,\n// \t\t\tisPopup: false,\n// \t\t\tpayload: {},\n// \t\t});\n// \t}, 100000);\n// });\n// console.log(formatDate());\nreturn peer;}function addPeer(incomingSignal,callerID,stream){console.log(\"Add Peer\");var peer=new Peer({initiator:false,trickle:false,stream:stream});adminPeer.current=peer;// 1 accepting the incoming signal that this will return the signal\npeer.signal(incomingSignal);peer.on(\"signal\",function(signal){socketRef.current.emit(\"returning signal\",{signal:signal,callerID:callerID});});// peer.on(\"data\", (data) => {\n// \tconsole.log(data + \"ADD DATA\");\n// \tclearTimeout(alertTimeout);\n// \tmessgListReducer({\n// \t\ttype: \"addMessage\",\n// \t\tpayload: {\n// \t\t\tuser: callerID,\n// \t\t\tmsg: data.toString(),\n// \t\t\ttime: formatDate(),\n// \t\t},\n// \t});\n// \tsetMessageAlert({\n// \t\talert: true,\n// \t\tisPopup: true,\n// \t\tpayload: {\n// \t\t\tuser: callerID,\n// \t\t\tmsg: data.toString(),\n// \t\t},\n// \t});\n// \talertTimeout = setTimeout(() => {\n// \t\tsetMessageAlert({\n// \t\t\t...messageAlert,\n// \t\t\tisPopup: false,\n// \t\t\tpayload: {},\n// \t\t});\n// \t}, 100000);\n// });\nreturn peer;}var screenShare=function screenShare(){navigator.mediaDevices//Cursor True is means sending cursor also of the person sharing screen to the person recieving the screen\n.getDisplayMedia({cursor:true}).then(function(screenStream){console.log(\"SCREEN STREAM\",screenStream);console.log(userVideo.current);peers.map(function(peer,index){console.log(peer);peer.replaceTrack(//0th track is the screen track\nstreamObj.getVideoTracks()[0],screenStream.getVideoTracks()[0],streamObj);});setIsPresenting(true);//WHEN SHARING STOPS RETURN TO NORMAl STATE\n//RESPONSIBLE FOR WORKING OF STOP BUTTON\nsetScreenCastStream(screenStream);screenStream.getTracks()[0].onended=function(){peers.map(function(peer,index){console.log(\"CALLED\");peer.replaceTrack(screenStream.getVideoTracks()[0],streamObj.getVideoTracks()[0],streamObj);});setIsPresenting(false);};});};var stopScreenShare=function stopScreenShare(){screenCastStream.getVideoTracks().forEach(function(track){track.stop();});// Replace with video tracks\npeers.map(function(peer,index){peer.replaceTrack(screenCastStream.getVideoTracks()[0],streamObj.getVideoTracks()[0],streamObj);setIsPresenting(false);});};var toggleVideo=function toggleVideo(value){if(value){userVideo.current.play();navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){userVideo.current.srcObject=stream;});}else{navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){userVideo.current.srcObject=stream.stop;});}setIsVideo(value);};var disconnect=function disconnect(){console.log(\"Clicked\");socketRef.current.disconnect();history.push(\"/\");};// console.log(messgListReducer);\nvar sendMsg=function sendMsg(msg){//Send From one peer to another\nif(currentPeer.current){currentPeer.current.send(msg);}if(adminPeer.current){adminPeer.current.send(msg);}socketRef.current.emit(\"prevMessage\",prevMessage);socketRef.current.emit(\"chatMessages\",{msg:msg,user:socketRef.current.id,time:formatDate()});messgListReducer({type:\"addMessage\",payload:{msg:msg,user:socketRef.current.id,time:formatDate()}});};useEffect(function(){socketRef.current.on(\"allMessages\",function(payload){console.log(payload.chatMessages);setPrevMessage(payload.chatMessages);setMessageList(payload.chatMessages);setMessageAlert({alert:true,isPopup:true,payload:{user:payload.payload.user,msg:payload.payload.msg}});// eslint-disable-next-line react-hooks/exhaustive-deps\nalertTimeout=setTimeout(function(){setMessageAlert(_objectSpread(_objectSpread({},messageAlert),{},{isPopup:false,payload:{}}));},100000);});socketRef.current.on(\"currentUserMessages\",function(payload){setMessageList(payload.chatMessages);setPrevMessage(payload.chatMessages);});},[]);return/*#__PURE__*/_jsxs(\"div\",{class:\"videoScreen\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"video\",{style:vidStyle,muted:!isAudio,ref:userVideo,autoPlay:true,controls:isPresenting}),peers.map(function(peer,index){return/*#__PURE__*/_jsx(Video,{peer:peer,numUsers:numUsers.current,isAudio:isAudio},index);})]}),/*#__PURE__*/_jsx(MeetingHeader,{setMessenger:setMessenger,id:id,setMessageAlert:setMessageAlert,messageAlert:messageAlert}),/*#__PURE__*/_jsx(MeetingFooter,{isPresenting:isPresenting,screenShare:screenShare,stopScreenShare:stopScreenShare,disconnect:disconnect,setIsAudio:setIsAudio,isVideo:isVideo,isAudio:isAudio,toggleVideo:toggleVideo}),isAdmin&&meetingInfoPopUp&&/*#__PURE__*/_jsx(MeetingInfo,{url:url,setMeetingInfoPopUp:setMeetingInfoPopUp}),isMessenger?/*#__PURE__*/_jsx(Messenger,{setMessenger:setMessenger,sendMsg:sendMsg// messageListState={messageListState}\n,messageList:messageList// userMessage={userMessage}\n}):messageAlert.isPopup&&/*#__PURE__*/_jsx(Alert,{messageAlert:messageAlert})]});};export default Room;","map":{"version":3,"sources":["C:/Users/jayka/web development/google-meet/client/src/components/MeetingPage/Room.js"],"names":["React","useEffect","useRef","useState","useReducer","useHistory","io","Peer","MeetingHeader","MeetingFooter","MeetingInfo","Alert","Messenger","Player","ControlBar","PlayToggle","moment","vidStyle","height","width","padding","paddingBottom","objectFit","Video","props","ref","peer","on","stream","console","log","current","srcObject","isAudio","MessageListReducer","state","action","type","payload","Room","id","isAdmin","setMeetingInfoPopUp","url","meetingInfoPopUp","isMessenger","setMessenger","numUsers","history","peers","setPeers","socketRef","userVideo","peersRef","currentPeer","adminPeer","screenStream","roomID","setIsAudio","streamObj","setStreamObj","screenCastStream","setScreenCastStream","isPresenting","setIsPresenting","isVideo","setIsVideo","initialState","messageListState","messgListReducer","messageList","setMessageList","messageAlert","setMessageAlert","prevMessage","setPrevMessage","alertTimeout","formatDate","format","connect","navigator","mediaDevices","getUserMedia","video","audio","then","emit","users","peersForVideo","forEach","userID","createPeer","push","peerID","length","addPeer","signal","callerID","item","find","p","userToSignal","initiator","trickle","incomingSignal","screenShare","getDisplayMedia","cursor","map","index","replaceTrack","getVideoTracks","getTracks","onended","stopScreenShare","track","stop","toggleVideo","value","play","disconnect","sendMsg","msg","send","user","time","chatMessages","alert","isPopup","setTimeout"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState, useReducer } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport io from \"socket.io-client\";\r\nimport Peer from \"simple-peer\";\r\nimport MeetingHeader from \"./meetingHeader\";\r\nimport MeetingFooter from \"./meetingFooter\";\r\nimport MeetingInfo from \"./meetingInfo\";\r\nimport Alert from \"./alert\";\r\nimport Messenger from \"./messenger\";\r\nimport { Player, ControlBar, PlayToggle } from \"video-react\";\r\nimport moment from \"moment\";\r\n\r\nconst vidStyle = {\r\n\theight: `264.15px`,\r\n\twidth: \"639.9px\",\r\n\tpadding: \"10px\",\r\n\tpaddingBottom: \"5px\",\r\n\tobjectFit: \"fill\",\r\n};\r\n\r\nconst Video = (props) => {\r\n\tconst ref = useRef();\r\n\t// console.log(\"VIDEO CALLED\" + JSON.stringify(props.peer));\r\n\tuseEffect(() => {\r\n\t\tprops.peer.on(\"stream\", (stream) => {\r\n\t\t\tconsole.log(\"ENTE0RD\" + stream);\r\n\t\t\tref.current.srcObject = stream;\r\n\t\t});\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<video\r\n\t\t\tstyle={vidStyle}\r\n\t\t\tmuted={!props.isAudio}\r\n\t\t\tref={ref}\r\n\t\t\tautoPlay\r\n\t\t\tcontrols\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nconst MessageListReducer = (state, action) => {\r\n\t// let draftState = [...state];\r\n\tswitch (action.type) {\r\n\t\tcase \"addMessage\":\r\n\t\t\treturn [...state, action.payload];\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nconst Room = ({ id, isAdmin, setMeetingInfoPopUp, url, meetingInfoPopUp }) => {\r\n\tconst [isMessenger, setMessenger] = useState(false);\r\n\r\n\tconst numUsers = useRef();\r\n\tlet history = useHistory();\r\n\tconst [peers, setPeers] = useState([]);\r\n\tconst socketRef = useRef();\r\n\tconst userVideo = useRef();\r\n\tconst peersRef = useRef([]);\r\n\tconst currentPeer = useRef();\r\n\tconst adminPeer = useRef();\r\n\tconst screenStream = useRef();\r\n\tconst roomID = id;\r\n\tconst [isAudio, setIsAudio] = useState(false);\r\n\tconst [streamObj, setStreamObj] = useState();\r\n\tconst [screenCastStream, setScreenCastStream] = useState();\r\n\tconst [isPresenting, setIsPresenting] = useState();\r\n\tconst [isVideo, setIsVideo] = useState(true);\r\n\tconst initialState = [];\r\n\tconst [messageListState, messgListReducer] = useReducer(\r\n\t\tMessageListReducer,\r\n\t\tinitialState\r\n\t);\r\n\t// const messageList=useRef()\r\n\tconst [messageList, setMessageList] = useState([]);\r\n\tconst [messageAlert, setMessageAlert] = useState({});\r\n\tconst [prevMessage, setPrevMessage] = useState();\r\n\tlet alertTimeout = null;\r\n\r\n\tconst formatDate = () => {\r\n\t\treturn moment().format(\"LT\");\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tsocketRef.current = io.connect(\"/\");\r\n\t\tnavigator.mediaDevices\r\n\t\t\t.getUserMedia({ video: true, audio: true })\r\n\t\t\t.then((stream) => {\r\n\t\t\t\tsetStreamObj(stream);\r\n\t\t\t\tuserVideo.current.srcObject = stream;\r\n\r\n\t\t\t\tconsole.log(userVideo.current);\r\n\r\n\t\t\t\t// LOGIC THAT USER HAS JOINED THE ROOM\r\n\r\n\t\t\t\t//THIS EVENT Is NOT CACHED AT BACKEND\r\n\t\t\t\t//.emit means sending  to backend\r\n\t\t\t\tsocketRef.current.emit(\"JOINED ROOM\");\r\n\t\t\t\tsocketRef.current.emit(\"join room\", roomID);\r\n\t\t\t\t// Recieve users from backened\r\n\t\t\t\t// if (!props.isAdmin) {\r\n\r\n\t\t\t\tsocketRef.current.on(\"all users\", (users) => {\r\n\t\t\t\t\t//peers is for how many videos are rendering\r\n\t\t\t\t\tconsole.log(users);\r\n\t\t\t\t\tconst peersForVideo = [];\r\n\t\t\t\t\tusers.forEach((userID) => {\r\n\t\t\t\t\t\tconsole.log(userID + \" USER ID OF USER IN THE ROOM \");\r\n\t\t\t\t\t\tconsole.log(socketRef.current);\r\n\t\t\t\t\t\t//socketRef.current.id is the of user currently joined\r\n\t\t\t\t\t\t// UserID  id's of all those inside the meeting\r\n\r\n\t\t\t\t\t\tconst peer = createPeer(userID, socketRef.current.id, stream);\r\n\t\t\t\t\t\t//peersRef is for which is having connection with which\r\n\t\t\t\t\t\tpeersRef.current.push({\r\n\t\t\t\t\t\t\tpeerID: userID,\r\n\t\t\t\t\t\t\tpeer,\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tpeersForVideo.push(peer);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (peers.length <= 4) {\r\n\t\t\t\t\t\tsetPeers(peersForVideo);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t//PERSON IN THE ROOM GETS NOTIFIED THAT SOMEBODY HAS JOINED\r\n\t\t\t\t//.on means recieving from backend\r\n\t\t\t\tsocketRef.current.on(\"user joined\", (payload) => {\r\n\t\t\t\t\tconst peer = addPeer(payload.signal, payload.callerID, stream);\r\n\r\n\t\t\t\t\tpeersRef.current.push({\r\n\t\t\t\t\t\tpeerID: payload.callerID,\r\n\t\t\t\t\t\tpeer,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsetPeers((users) => [...users, peer]);\r\n\t\t\t\t});\r\n\t\t\t\tsocketRef.current.on(\"receiving returned signal\", (payload) => {\r\n\t\t\t\t\t// signal has been send to multiple now multiple users are sending back the signal to caller\r\n\t\t\t\t\tconst item = peersRef.current.find((p) => p.peerID === payload.id);\r\n\t\t\t\t\tconsole.log(item);\r\n\r\n\t\t\t\t\titem.peer.signal(payload.signal);\r\n\t\t\t\t\t// currentPeer.current = item.peer;\r\n\t\t\t\t\t// returningSignal()\r\n\t\t\t\t});\r\n\t\t\t\t// }\r\n\t\t\t});\r\n\t}, []);\r\n\r\n\tfunction createPeer(userToSignal, callerID, stream) {\r\n\t\tconsole.log(\"CREATE PEER\");\r\n\t\tconst peer = new Peer({\r\n\t\t\tinitiator: true,\r\n\t\t\t//trickle wait for all the data to send makes it slow\r\n\t\t\ttrickle: false,\r\n\t\t\tstream,\r\n\t\t});\r\n\t\tcurrentPeer.current = peer;\r\n\r\n\t\t//generates signal\r\n\t\t//sending to backend\r\n\t\tconsole.log(userToSignal + \"  \" + callerID);\r\n\t\tpeer.on(\"signal\", (signal) => {\r\n\t\t\tsocketRef.current.emit(\"sending signal\", {\r\n\t\t\t\tuserToSignal,\r\n\t\t\t\tcallerID,\r\n\t\t\t\tsignal,\r\n\t\t\t});\r\n\t\t});\r\n\t\t// peer.on(\"data\", (data) => {\r\n\t\t// \tconsole.log(data + \"DATA\");\r\n\t\t// \tclearTimeout(alertTimeout);\r\n\t\t// \tmessgListReducer({\r\n\t\t// \t\ttype: \"addMessage\",\r\n\t\t// \t\tpayload: {\r\n\t\t// \t\t\tuser: userToSignal,\r\n\t\t// \t\t\tmsg: data.toString(),\r\n\t\t// \t\t\ttime: formatDate(),\r\n\t\t// \t\t},\r\n\t\t// \t});\r\n\t\t// \tsetMessageAlert({\r\n\t\t// \t\talert: true,\r\n\t\t// \t\tisPopup: true,\r\n\t\t// \t\tpayload: {\r\n\t\t// \t\t\tuser: userToSignal,\r\n\t\t// \t\t\tmsg: data.toString(),\r\n\t\t// \t\t},\r\n\t\t// \t});\r\n\r\n\t\t// \talertTimeout = setTimeout(() => {\r\n\t\t// \t\tsetMessageAlert({\r\n\t\t// \t\t\t...messageAlert,\r\n\t\t// \t\t\tisPopup: false,\r\n\t\t// \t\t\tpayload: {},\r\n\t\t// \t\t});\r\n\t\t// \t}, 100000);\r\n\t\t// });\r\n\t\t// console.log(formatDate());\r\n\r\n\t\treturn peer;\r\n\t}\r\n\r\n\tfunction addPeer(incomingSignal, callerID, stream) {\r\n\t\tconsole.log(\"Add Peer\");\r\n\t\tconst peer = new Peer({\r\n\t\t\tinitiator: false,\r\n\t\t\ttrickle: false,\r\n\t\t\tstream,\r\n\t\t});\r\n\t\tadminPeer.current = peer;\r\n\t\t// 1 accepting the incoming signal that this will return the signal\r\n\t\tpeer.signal(incomingSignal);\r\n\r\n\t\tpeer.on(\"signal\", (signal) => {\r\n\t\t\tsocketRef.current.emit(\"returning signal\", { signal, callerID });\r\n\t\t});\r\n\r\n\t\t// peer.on(\"data\", (data) => {\r\n\t\t// \tconsole.log(data + \"ADD DATA\");\r\n\t\t// \tclearTimeout(alertTimeout);\r\n\t\t// \tmessgListReducer({\r\n\t\t// \t\ttype: \"addMessage\",\r\n\t\t// \t\tpayload: {\r\n\t\t// \t\t\tuser: callerID,\r\n\t\t// \t\t\tmsg: data.toString(),\r\n\t\t// \t\t\ttime: formatDate(),\r\n\t\t// \t\t},\r\n\t\t// \t});\r\n\r\n\t\t// \tsetMessageAlert({\r\n\t\t// \t\talert: true,\r\n\t\t// \t\tisPopup: true,\r\n\t\t// \t\tpayload: {\r\n\t\t// \t\t\tuser: callerID,\r\n\t\t// \t\t\tmsg: data.toString(),\r\n\t\t// \t\t},\r\n\t\t// \t});\r\n\r\n\t\t// \talertTimeout = setTimeout(() => {\r\n\t\t// \t\tsetMessageAlert({\r\n\t\t// \t\t\t...messageAlert,\r\n\t\t// \t\t\tisPopup: false,\r\n\t\t// \t\t\tpayload: {},\r\n\t\t// \t\t});\r\n\t\t// \t}, 100000);\r\n\t\t// });\r\n\t\treturn peer;\r\n\t}\r\n\r\n\tconst screenShare = () => {\r\n\t\tnavigator.mediaDevices\r\n\t\t\t//Cursor True is means sending cursor also of the person sharing screen to the person recieving the screen\r\n\t\t\t.getDisplayMedia({ cursor: true })\r\n\t\t\t.then((screenStream) => {\r\n\t\t\t\tconsole.log(\"SCREEN STREAM\", screenStream);\r\n\t\t\t\tconsole.log(userVideo.current);\r\n\r\n\t\t\t\tpeers.map((peer, index) => {\r\n\t\t\t\t\tconsole.log(peer);\r\n\t\t\t\t\tpeer.replaceTrack(\r\n\t\t\t\t\t\t//0th track is the screen track\r\n\t\t\t\t\t\tstreamObj.getVideoTracks()[0],\r\n\t\t\t\t\t\tscreenStream.getVideoTracks()[0],\r\n\t\t\t\t\t\tstreamObj\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t\tsetIsPresenting(true);\r\n\r\n\t\t\t\t//WHEN SHARING STOPS RETURN TO NORMAl STATE\r\n\t\t\t\t//RESPONSIBLE FOR WORKING OF STOP BUTTON\r\n\t\t\t\tsetScreenCastStream(screenStream);\r\n\r\n\t\t\t\tscreenStream.getTracks()[0].onended = () => {\r\n\t\t\t\t\tpeers.map((peer, index) => {\r\n\t\t\t\t\t\tconsole.log(\"CALLED\");\r\n\t\t\t\t\t\tpeer.replaceTrack(\r\n\t\t\t\t\t\t\tscreenStream.getVideoTracks()[0],\r\n\t\t\t\t\t\t\tstreamObj.getVideoTracks()[0],\r\n\t\t\t\t\t\t\tstreamObj\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetIsPresenting(false);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t};\r\n\tconst stopScreenShare = () => {\r\n\t\tscreenCastStream.getVideoTracks().forEach(function (track) {\r\n\t\t\ttrack.stop();\r\n\t\t});\r\n\t\t// Replace with video tracks\r\n\t\tpeers.map((peer, index) => {\r\n\t\t\tpeer.replaceTrack(\r\n\t\t\t\tscreenCastStream.getVideoTracks()[0],\r\n\t\t\t\tstreamObj.getVideoTracks()[0],\r\n\t\t\t\tstreamObj\r\n\t\t\t);\r\n\t\t\tsetIsPresenting(false);\r\n\t\t});\r\n\t};\r\n\r\n\tconst toggleVideo = (value) => {\r\n\t\tif (value) {\r\n\t\t\tuserVideo.current.play();\r\n\t\t\tnavigator.mediaDevices\r\n\t\t\t\t.getUserMedia({ video: true, audio: true })\r\n\t\t\t\t.then((stream) => {\r\n\t\t\t\t\tuserVideo.current.srcObject = stream;\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tnavigator.mediaDevices\r\n\t\t\t\t.getUserMedia({ video: true, audio: true })\r\n\t\t\t\t.then((stream) => {\r\n\t\t\t\t\tuserVideo.current.srcObject = stream.stop;\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tsetIsVideo(value);\r\n\t};\r\n\r\n\tconst disconnect = () => {\r\n\t\tconsole.log(\"Clicked\");\r\n\t\tsocketRef.current.disconnect();\r\n\t\thistory.push(\"/\");\r\n\t};\r\n\r\n\t// console.log(messgListReducer);\r\n\r\n\tconst sendMsg = (msg) => {\r\n\t\t//Send From one peer to another\r\n\r\n\t\tif (currentPeer.current) {\r\n\t\t\tcurrentPeer.current.send(msg);\r\n\t\t}\r\n\t\tif (adminPeer.current) {\r\n\t\t\tadminPeer.current.send(msg);\r\n\t\t}\r\n        socketRef.current.emit(\"prevMessage\",prevMessage)\r\n\r\n\t\tsocketRef.current.emit(\"chatMessages\", {\r\n\t\t\t\r\n\t\t\tmsg: msg,\r\n\t\t\tuser: socketRef.current.id,\r\n\t\t\ttime: formatDate(),\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\t\r\n\t\tmessgListReducer({\r\n\t\t\ttype: \"addMessage\",\r\n\t\t\tpayload: {\r\n\t\t\t\tmsg: msg,\r\n\t\t\t\tuser: socketRef.current.id,\r\n\t\t\t\ttime: formatDate(),\r\n\t\t\t},\r\n\t\t});\r\n\t};\r\n\tuseEffect(() => {\r\n\t\tsocketRef.current.on(\"allMessages\", (payload) => {\r\n\t\t\tconsole.log(payload.chatMessages);\r\n\t\t\tsetPrevMessage(payload.chatMessages);\r\n\t\t\tsetMessageList(payload.chatMessages);\r\n\r\n\t\t\tsetMessageAlert({\r\n\t\t\t\talert: true,\r\n\t\t\t\tisPopup: true,\r\n\t\t\t\tpayload: {\r\n\t\t\t\t\tuser: payload.payload.user,\r\n\t\t\t\t\tmsg: payload.payload.msg,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t\talertTimeout = setTimeout(() => {\r\n\t\t\t\tsetMessageAlert({\r\n\t\t\t\t\t...messageAlert,\r\n\t\t\t\t\tisPopup: false,\r\n\t\t\t\t\tpayload: {},\r\n\t\t\t\t});\r\n\t\t\t}, 100000);\r\n\t\t});\r\n\r\n\t\tsocketRef.current.on(\"currentUserMessages\", (payload) => {\r\n\t\t\tsetMessageList(payload.chatMessages);\r\n\t\t\tsetPrevMessage(payload.chatMessages);\r\n\t\t});\r\n\t}, []);\r\n\treturn (\r\n\t\t<div class=\"videoScreen\">\r\n\t\t\t<div className=\"container\">\r\n\t\t\t\t<video\r\n\t\t\t\t\tstyle={vidStyle}\r\n\t\t\t\t\tmuted={!isAudio}\r\n\t\t\t\t\tref={userVideo}\r\n\t\t\t\t\tautoPlay\r\n\t\t\t\t\tcontrols={isPresenting}\r\n\t\t\t\t/>\r\n\t\t\t\t{peers.map((peer, index) => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<Video\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\tpeer={peer}\r\n\t\t\t\t\t\t\tnumUsers={numUsers.current}\r\n\t\t\t\t\t\t\tisAudio={isAudio}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t);\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t\t<MeetingHeader\r\n\t\t\t\tsetMessenger={setMessenger}\r\n\t\t\t\tid={id}\r\n\t\t\t\tsetMessageAlert={setMessageAlert}\r\n\t\t\t\tmessageAlert={messageAlert}\r\n\t\t\t/>\r\n\r\n\t\t\t<MeetingFooter\r\n\t\t\t\tisPresenting={isPresenting}\r\n\t\t\t\tscreenShare={screenShare}\r\n\t\t\t\tstopScreenShare={stopScreenShare}\r\n\t\t\t\tdisconnect={disconnect}\r\n\t\t\t\tsetIsAudio={setIsAudio}\r\n\t\t\t\tisVideo={isVideo}\r\n\t\t\t\tisAudio={isAudio}\r\n\t\t\t\ttoggleVideo={toggleVideo}\r\n\t\t\t/>\r\n\t\t\t{isAdmin && meetingInfoPopUp && (\r\n\t\t\t\t<MeetingInfo url={url} setMeetingInfoPopUp={setMeetingInfoPopUp} />\r\n\t\t\t)}\r\n\t\t\t{isMessenger ? (\r\n\t\t\t\t<Messenger\r\n\t\t\t\t\tsetMessenger={setMessenger}\r\n\t\t\t\t\tsendMsg={sendMsg}\r\n\t\t\t\t\t// messageListState={messageListState}\r\n\t\t\t\t\tmessageList={messageList}\r\n\t\t\t\t\t// userMessage={userMessage}\r\n\t\t\t\t/>\r\n\t\t\t) : (\r\n\t\t\t\tmessageAlert.isPopup && <Alert messageAlert={messageAlert} />\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Room;\r\n"]},"metadata":{},"sourceType":"module"}