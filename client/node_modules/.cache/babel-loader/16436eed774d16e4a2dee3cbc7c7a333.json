{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jayka\\\\web development\\\\google-meet\\\\src\\\\components\\\\vedioPage.jsx\",\n    _s = $RefreshSig$();\n\nimport react, { useState, useEffect, useReducer, useRef } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport MeetingHeader from \"./meetingHeader\";\nimport MeetingFooter from \"./meetingFooter\";\nimport MeetingInfo from \"./meetingInfo\";\nimport Messenger from \"./messenger\";\nimport Alert from \"./alert\";\nimport Peer from \"simple-peer\";\nimport { getCallId, saveCallId } from \"././services/UserService\";\nimport io from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction VideoPage() {\n  _s();\n\n  const history = useHistory();\n  const isAdmin = window.location.hash === \"#init\" ? true : false; //#init\n\n  console.log(window.location.hash);\n  const socket = io(\"http://localhost:9000\");\n  let alertTimeout = null;\n  const {\n    id\n  } = useParams();\n  const [height, setHeight] = useState(0);\n  const [width, setWidth] = useState(0); // let peer = null;\n\n  const url = `${window.location.origin}${window.location.pathname}`;\n  const [meetingInfoPopUp, setMeetingInfoPopUp] = useState(false);\n  const [isMessenger, setMessenger] = useState(false); // const [messageAlert, setMessageAlert] = useState({});\n  // const [isAudio, setIsAudio] = useState(true);\n  // const [streamObj, setStreamObj] = useState();\n  // //MESSAGE CHAT\n  // const intialState = [];\n  // const MessageListReducer = (state, action) => {\n  //   switch (action.type) {\n  //     case \"addMessage\":\n  //       return [...state, action.payload];\n  //     default:\n  //       return state;\n  //   }\n  // };\n  // const [messageList, setMessageList] = useReducer(\n  //   MessageListReducer,\n  //   intialState\n  // );\n  // const getRecieverCode = () => {\n  //   getCallId(id).then((response) => {\n  //     console.log(response);\n  //     peer.signal(response.data);\n  //   });\n  // };\n  // useEffect(() => {\n  //   //Call every time when page renders\n  //   if (isAdmin) {\n  //     setMeetingInfoPopUp(true);\n  //   }\n  //   initWebRTC();\n  //   socket.on(\"code\", (data) => {\n  //     console.log(data);\n  //     peer.signal(data);\n  //   });\n  // }, []);\n  // const initWebRTC = () => {\n  //   navigator.mediaDevices\n  //     .getUserMedia({\n  //       video: true,\n  //       audio: true,\n  //     })\n  //     .then((stream) => {\n  //       console.log(stream);\n  //       peer = new Peer({\n  //         initiator: isAdmin,\n  //         //trickle wait for all the data to send makes it slow\n  //         trickle: false,\n  //         stream: stream,\n  //       });\n  //       if (!isAdmin) {\n  //         getRecieverCode();\n  //       }\n  //       peer.on(\"signal\", (data) => {\n  //         if (isAdmin) {\n  //           console.log(\"Id : \" + id);\n  //           let payload = {\n  //             id: id,\n  //             signalData: data,\n  //           };\n  //           saveCallId(payload).then((response) => {\n  //             console.log(response);\n  //           });\n  //         } else {\n  //           //Socket event\n  //           // peer.on(\"open\", (id) => {\n  //           //   socket.emit(\"join-room\", id, data);\n  //           // });\n  //           //SENDING TO BACKEND\n  //           socket.emit(\"code\", data, id);\n  //         }\n  //       });\n  //       peer.on(\"connect\", () => {\n  //         console.log(\"peer connected\");\n  //       });\n  //       peer.on(\"stream\", (stream) => {\n  //         // got remote video stream, now let's show it in a video tag\n  //         var video = document.querySelector(\"video\");\n  //         if (\"srcObject\" in video) {\n  //           video.srcObject = stream;\n  //         } else {\n  //           video.src = window.URL.createObjectURL(stream); // for older browsers\n  //         }\n  //         video.play();\n  //       });\n  //     });\n  // };\n  // NEW START\n\n  const [peers, setPeers] = useState([]);\n  const socketRef = useRef();\n  const userVideo = useRef();\n  const peersRef = useRef([]); // OBTAINED USING USE PARAMS\n\n  const roomID = id;\n  useEffect(() => {\n    //Call every time when page renders\n    if (isAdmin) {\n      setMeetingInfoPopUp(true);\n    } // initWebRTC();\n    // ESTABLISHING CONNECT WITH BACKEND\n\n\n    socketRef.current = io.connect(\"http://localhost:9000\"); // LOGIC FOR SOMEBODY JOINING THE ROOM\n\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      var video = document.querySelector(\"video\");\n\n      if (\"srcObject\" in video) {\n        video.srcObject = stream;\n      } else {\n        video.src = window.URL.createObjectURL(stream); // for older browsers\n      }\n\n      video.play(); // userVideo.current.srcObject = stream;\n      // LOGIC THAT USER HAS JOINED THE ROOM\n      //THIS EVENT Is NOT CACHED AT BACKEND\n      //.emit means sending  to backend\n\n      socketRef.current.emit(\"JOINED ROOM\");\n      socketRef.current.emit(\"join room\", id); // Recieve users from backened\n\n      if (!isAdmin) {\n        socketRef.current.on(\"all users\", users => {\n          //peers is for how many videos are rendering\n          console.log(users.length);\n          const peersForVideos = [];\n          users.forEach(userID => {\n            console.log(userID + \" USER ID IN THE ROOM \");\n            console.log(socketRef.current); //socketRef.current.id is the of user currently joined\n            //UserID  id's of all those inside the meeting\n\n            const peer = createPeer(userID, socketRef.current.id, stream); //peersRef is for which is having connection with which\n\n            peersRef.current.push({\n              peerID: userID,\n              peer\n            });\n            peersForVideos.push(peer);\n            setPeers(peersForVideos);\n          });\n        }); //PERSON IN THE ROOM GETS NOTIFIED THAT SOMEBODY HAS JOINED\n        //.on means recieving from backend\n\n        socketRef.current.on(\"user joined\", payload => {\n          const peer = addPeer(payload.signal, payload.callerID, payload.stream);\n          peersRef.current.push({\n            peerID: payload.callerID,\n            peer\n          });\n          setPeers(prevUsers => [...prevUsers, peer]);\n          socketRef.current.on(\"receiving returned signal\", payload => {\n            // signal has been send to multiple now multiple users are sending back the signal to caller\n            const item = peersRef.current.find(p => {\n              return p.peerID === payload.id;\n            });\n            item.peer.signal(payload.signal);\n          });\n        });\n      }\n    });\n  }, []);\n\n  function createPeer(userToSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      //trickle wait for all the data to send makes it slow\n      trickle: false,\n      stream\n    }); //generates signal\n    //sending to backend\n\n    peer.on(\"signal\", signal => {\n      socketRef.current.emit(\"sending signal\", {\n        userToSignal,\n        callerID,\n        signal\n      });\n    });\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    }); // 1 accepting the incoming signal that tthis will return the signal\n\n    peer.signal(incomingSignal);\n    peer.on(\"signal\", signal => {\n      socketRef.current.emit(\"returning signal\", {\n        signal,\n        callerID\n      });\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    class: \"videoScreen\",\n    children: [/*#__PURE__*/_jsxDEV(MeetingHeader, {\n      setMessenger: setMessenger\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MeetingFooter, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this), isAdmin && meetingInfoPopUp && /*#__PURE__*/_jsxDEV(MeetingInfo, {\n      url: url,\n      setMeetingInfoPopUp: setMeetingInfoPopUp\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 9\n    }, this), isMessenger ? /*#__PURE__*/_jsxDEV(Messenger, {\n      setMessenger: setMessenger // messageList={messageList}\n\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(Alert, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 249,\n    columnNumber: 5\n  }, this);\n}\n\n_s(VideoPage, \"z/7oF56aMo1LtFAhh7HXFK/jkSg=\", false, function () {\n  return [useHistory, useParams];\n});\n\n_c = VideoPage;\nexport default VideoPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"VideoPage\");","map":{"version":3,"sources":["C:/Users/jayka/web development/google-meet/src/components/vedioPage.jsx"],"names":["react","useState","useEffect","useReducer","useRef","useParams","useHistory","MeetingHeader","MeetingFooter","MeetingInfo","Messenger","Alert","Peer","getCallId","saveCallId","io","VideoPage","history","isAdmin","window","location","hash","console","log","socket","alertTimeout","id","height","setHeight","width","setWidth","url","origin","pathname","meetingInfoPopUp","setMeetingInfoPopUp","isMessenger","setMessenger","peers","setPeers","socketRef","userVideo","peersRef","roomID","current","connect","navigator","mediaDevices","getUserMedia","video","audio","then","stream","document","querySelector","srcObject","src","URL","createObjectURL","play","emit","on","users","length","peersForVideos","forEach","userID","peer","createPeer","push","peerID","payload","addPeer","signal","callerID","prevUsers","item","find","p","userToSignal","initiator","trickle","incomingSignal"],"mappings":"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","sourcesContent":["import react, { useState, useEffect, useReducer, useRef } from \"react\";\n\nimport { useParams, useHistory } from \"react-router-dom\";\nimport MeetingHeader from \"./meetingHeader\";\nimport MeetingFooter from \"./meetingFooter\";\nimport MeetingInfo from \"./meetingInfo\";\nimport Messenger from \"./messenger\";\nimport Alert from \"./alert\";\nimport Peer from \"simple-peer\";\nimport { getCallId, saveCallId } from \"././services/UserService\";\nimport io from \"socket.io-client\";\nfunction VideoPage() {\n  const history = useHistory();\n  const isAdmin = window.location.hash === \"#init\" ? true : false;\n\n  //#init\n  console.log(window.location.hash);\n  const socket = io(\"http://localhost:9000\");\n  let alertTimeout = null;\n  const { id } = useParams();\n  const [height,setHeight]=useState(0)\n  const [width,setWidth]=useState(0)\n\n  // let peer = null;\n  const url = `${window.location.origin}${window.location.pathname}`;\n\n  const [meetingInfoPopUp, setMeetingInfoPopUp] = useState(false);\n  const [isMessenger, setMessenger] = useState(false);\n  // const [messageAlert, setMessageAlert] = useState({});\n  // const [isAudio, setIsAudio] = useState(true);\n  // const [streamObj, setStreamObj] = useState();\n\n  // //MESSAGE CHAT\n  // const intialState = [];\n  // const MessageListReducer = (state, action) => {\n  //   switch (action.type) {\n  //     case \"addMessage\":\n  //       return [...state, action.payload];\n\n  //     default:\n  //       return state;\n  //   }\n  // };\n\n  // const [messageList, setMessageList] = useReducer(\n  //   MessageListReducer,\n  //   intialState\n  // );\n\n  // const getRecieverCode = () => {\n  //   getCallId(id).then((response) => {\n  //     console.log(response);\n  //     peer.signal(response.data);\n  //   });\n  // };\n\n  // useEffect(() => {\n  //   //Call every time when page renders\n  //   if (isAdmin) {\n  //     setMeetingInfoPopUp(true);\n  //   }\n  //   initWebRTC();\n  //   socket.on(\"code\", (data) => {\n  //     console.log(data);\n  //     peer.signal(data);\n  //   });\n  // }, []);\n\n  // const initWebRTC = () => {\n  //   navigator.mediaDevices\n  //     .getUserMedia({\n  //       video: true,\n  //       audio: true,\n  //     })\n  //     .then((stream) => {\n  //       console.log(stream);\n\n  //       peer = new Peer({\n  //         initiator: isAdmin,\n  //         //trickle wait for all the data to send makes it slow\n  //         trickle: false,\n  //         stream: stream,\n  //       });\n\n  //       if (!isAdmin) {\n  //         getRecieverCode();\n  //       }\n\n  //       peer.on(\"signal\", (data) => {\n  //         if (isAdmin) {\n  //           console.log(\"Id : \" + id);\n  //           let payload = {\n  //             id: id,\n  //             signalData: data,\n  //           };\n  //           saveCallId(payload).then((response) => {\n  //             console.log(response);\n  //           });\n  //         } else {\n  //           //Socket event\n  //           // peer.on(\"open\", (id) => {\n  //           //   socket.emit(\"join-room\", id, data);\n  //           // });\n\n  //           //SENDING TO BACKEND\n  //           socket.emit(\"code\", data, id);\n  //         }\n  //       });\n\n  //       peer.on(\"connect\", () => {\n  //         console.log(\"peer connected\");\n  //       });\n\n  //       peer.on(\"stream\", (stream) => {\n  //         // got remote video stream, now let's show it in a video tag\n  //         var video = document.querySelector(\"video\");\n\n  //         if (\"srcObject\" in video) {\n  //           video.srcObject = stream;\n  //         } else {\n  //           video.src = window.URL.createObjectURL(stream); // for older browsers\n  //         }\n  //         video.play();\n  //       });\n  //     });\n  // };\n\n  // NEW START\n\n  const [peers, setPeers] = useState([]);\n  const socketRef = useRef();\n  const userVideo = useRef();\n  const peersRef = useRef([]);\n  // OBTAINED USING USE PARAMS\n  const roomID = id;\n\n  useEffect(() => {\n    //Call every time when page renders\n    if (isAdmin) {\n      setMeetingInfoPopUp(true);\n    }\n    // initWebRTC();\n    // ESTABLISHING CONNECT WITH BACKEND\n    socketRef.current = io.connect(\"http://localhost:9000\");\n    // LOGIC FOR SOMEBODY JOINING THE ROOM\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n      \n        var video = document.querySelector(\"video\");\n        if (\"srcObject\" in video) {\n          video.srcObject = stream;\n        } else {\n          video.src = window.URL.createObjectURL(stream); // for older browsers\n        }\n        video.play();\n\n\n        // userVideo.current.srcObject = stream;\n        // LOGIC THAT USER HAS JOINED THE ROOM\n\n        //THIS EVENT Is NOT CACHED AT BACKEND\n        //.emit means sending  to backend\n        socketRef.current.emit(\"JOINED ROOM\");\n        socketRef.current.emit(\"join room\", id);\n        // Recieve users from backened\n        if (!isAdmin) {\n          socketRef.current.on(\"all users\", (users) => {\n            //peers is for how many videos are rendering\n            console.log(users.length);\n            const peersForVideos = [];\n            users.forEach((userID) => {\n              console.log(userID + \" USER ID IN THE ROOM \");\n              console.log(socketRef.current );\n              //socketRef.current.id is the of user currently joined\n              //UserID  id's of all those inside the meeting\n\n              const peer = createPeer(userID, socketRef.current.id, stream);\n              //peersRef is for which is having connection with which\n              peersRef.current.push({\n                peerID: userID,\n                peer,\n              });\n              peersForVideos.push(peer);\n              setPeers(peersForVideos);\n            });\n          });\n          //PERSON IN THE ROOM GETS NOTIFIED THAT SOMEBODY HAS JOINED\n          //.on means recieving from backend\n          socketRef.current.on(\"user joined\", (payload) => {\n            const peer = addPeer(\n              payload.signal,\n              payload.callerID,\n              payload.stream\n            );\n            peersRef.current.push({\n              peerID: payload.callerID,\n              peer,\n            });\n            setPeers((prevUsers) => \n               [...prevUsers, peer]\n            );\n\n            socketRef.current.on(\"receiving returned signal\", (payload) => {\n              // signal has been send to multiple now multiple users are sending back the signal to caller\n              const item = peersRef.current.find((p) => {\n                return p.peerID === payload.id;\n              });\n              item.peer.signal(payload.signal);\n            });\n          });\n        }\n      });\n  }, []);\n\n  function createPeer(userToSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      //trickle wait for all the data to send makes it slow\n      trickle: false,\n      stream,\n    });\n    //generates signal\n    //sending to backend\n    peer.on(\"signal\", (signal) => {\n      socketRef.current.emit(\"sending signal\", {\n        userToSignal,\n        callerID,\n        signal,\n      });\n    });\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream,\n    });\n    // 1 accepting the incoming signal that tthis will return the signal\n    peer.signal(incomingSignal);\n\n    peer.on(\"signal\", (signal) => {\n      socketRef.current.emit(\"returning signal\", { signal, callerID });\n    });\n  }\n\n  return (\n    <div class=\"videoScreen\">\n      <MeetingHeader setMessenger={setMessenger}  />\n      <MeetingFooter />\n      {isAdmin && meetingInfoPopUp && (\n        <MeetingInfo url={url} setMeetingInfoPopUp={setMeetingInfoPopUp} />\n      )}\n      {isMessenger ? (\n        <Messenger\n          setMessenger={setMessenger}\n          // messageList={messageList}\n        />\n      ) : (\n        <Alert />\n      )}\n    </div>\n  );\n}\n\nexport default VideoPage;\n"]},"metadata":{},"sourceType":"module"}